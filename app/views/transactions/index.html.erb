<div class="group_header wellgroup">
  <div class="group_image_container">
    <%= image_tag('icons/Profile32x32.png', :size => "27x27") %>
  </div>
  <div class="group_information">
    <h3> My Profile </h3>
    <button class="btn primary" onClick="Utilities.redirectTo(event,'<%= new_group_path %>');" type="button">Create Group</button>
  </div>
</div>
<% if @usergroups.blank? %>
<div class="wellempty">
  New to Magic Accounts ? Start over by creating a Group !
</div>
<% else %>
<div id="group_tree" class="accordion">
  <% @usergroups.each_with_index do |group,index| -%>
    <div class="accordion-group">
      <div class="accordion-heading">
        <a <%= "href='#group_#{group.id}' data-parent='#group_tree' data-toggle='collapse' class='accordion-toggle'"%>>
          <div class="group_image_container">
            <%= image_tag('icons/Group32x32.png', :size => "27x27") %>
          </div>
          <div class="group_information">
            <h3> <%=  group.name %> </h3>
            <% if group.user == current_user %>
            <h5>(Owner)</h5>
            <%else%>
            <h5>(Member)</h5>
            <%end%>
            <strong><button class="btn primary" onClick="Utilities.redirectTo(event,'<%= new_account_path(:groupid => group.id) %>');" type="button">Create Account</button></strong>
            <% if group.user == current_user %>
              <button class="btn primary" onClick="Utilities.redirectTo(event,'<%= groups_path %>');" type="button">Manage</button>
            <%end%>
          </div>
        </a>        
      </div>
      <% accounts_by_group = @accounts.select { |account| account if group.id == account.group_id} %>
      <div <%= "class='accordian-body #{index == 0 ? "in' style='height: auto;'" : "collapse'"} id='group_#{group.id}'" %>>
        <div class="accordion-inner">
          <% if accounts_by_group.blank? %>
          <div class="wellempty account_block">
            There are no accounts for this group
          </div>
          <%else%>
          <% accounts_by_group.each do |account| -%>
          <% if account  %>
          <div class="group_header wellaccount">
            <div class="group_image_container">
              <%= image_tag('icons/Account32x32.png', :size => "27x27") %>
            </div>
            <div class="group_information">
              <h3> <%=  account.name %></h3>
              <% if account.user == current_user %>
              <h5>(Owner)</h5>
              <%else%>
              <h5>(Member)</h5>
              <%end%>
                <button class="btn account" onClick="Utilities.redirectTo(event,'<%= "transactions/view/#{account.id}" %>');" type="button">Transactions</button>
              <% if account.user == current_user %>
                <button class="btn account" onClick="Utilities.redirectTo(event,'<%= accounts_path %>');" type="button">Manage</button>
              <%end%>
            </div>
          </div>
          <%end%>
          <% transactions_by_account = @balance.select {|bal| bal if (account.group_id == bal.group_id && account.id == bal.account_id) }%>
          <% if transactions_by_account.blank? %>
          <div class="wellempty account_block">
            You have no transactions for this account
          </div>
          <%else%>
          <table class="table table-striped table-bordered account_block">
           <thead>
            <tr>
              <th><i class="icon-user"></i> User</th>
              <th><i class="icon-arrow-down"></i> Investments</th>
              <th><i class="icon-arrow-up"></i> Expenditures</th>
              <th><i class="icon-eye-open"></i> Actions</th>
            </tr>
            </thead>
            <tbody>
            <% transactions_by_account.each do |balance| -%>
             <% if balance %>
              <tr>
              <td><%= balance.user_name == User.find(current_user).name ? "Myself" : balance.user_name %></td>
              <td>Rs. <%= balance.investments %></td>
              <td>Rs. <%= balance.expenditures %></td>

              <td>
                <% if balance.investments.to_f - balance.expenditures.to_f < 0 %>
                <span class="balance-label label-important">Rs. <%= balance.expenditures.to_f - balance.investments.to_f %></span>
                <% elsif balance.investments.to_f - balance.expenditures.to_f > 0  %>
                <span class="balance-label label-success">Rs. <%= balance.investments.to_f - balance.expenditures.to_f %></span>
                <% end -%>
              </td>
              </tr>
              <% end end %>
             </tbody>
          </table>
          <% end %>
          <% end end -%>
        </div>
      </div>
    </div>
  <%  end -%>
</div>
<% end %>


