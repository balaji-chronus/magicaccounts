<div class="group_header wellblue">
    <h3> My Groups </h3>
    <strong><%= link_to "Create Group", new_group_path, :method => "get", :class => 'btn primary' %></strong>
</div>
<% if @usergroups.blank? %>
<div class="well">
  New to Magic Accounts ? Start over by creating a Group !
</div>
<% else %>
<% @usergroups.each do |group| -%>
<div class="group_header wellblue group_block">
    <h3> <%=  group.name %> </h3>
    <% if group.user_id == current_user %>
    <h5>(Owner)</h5>
    <%else%>
    <h5>(Member)</h5>
    <%end%>
    
    <strong><%= link_to "Create Account", { :controller => 'accounts', :action => 'new', :groupid => group.id },:method => "get", :class => 'btn primary' %></strong>
    <% if group.user_id == current_user %>
      <%=  link_to "Manage Group", {:controller => 'groups', :action => 'index'}, {:class => 'headerlinks'} %>
    <%end%>    
</div>
<% accounts_by_group = @accounts.select { |account| account if group.id == account.group_id} %>
<% if accounts_by_group.blank? %>
<div class="well account_block">
  There are no accounts for this group
</div>
<%else%>
<% accounts_by_group.each do |account| -%>
<% if account  %>
<div class="group_header wellgreen">
    <h3> <%=  account.name %></h3>
    <% if account.user_id == current_user %>
    <h5>(Owner)</h5>
    <%else%>
    <h5>(Member)</h5>
    <%end%>    
    <strong><%=  link_to "Transactions", {:controller => 'transactions', :action => 'view', :accountid => account.id}, {:class => 'btn success'} %></strong>
    <% if account.user_id == current_user %>
    <%=  link_to "Manage Account", {:controller => 'accounts', :action => 'index'}, {:class => 'headerlinks'} %>
    <%end%>
</div>
<%end%>
<% transactions_by_account = @balance.select {|bal| bal if (account.group_id == bal.group_id && account.id == bal.account_id) }%>
<% if transactions_by_account.blank? %>
<div class="well account_block">
  You have no transactions for this account
</div>
<%else%>
<table class="table table-striped table-bordered account_block">
 <thead>
  <tr>
    <th>User</th>
    <th>Investments</th>
    <th>Expenditures</th>    
    <th>Actions</th>
  </tr>
  </thead>
  <tbody>
  <% transactions_by_account.each do |balance| -%>
   <% if balance %>
    <tr>
    <td><%= balance.user_name == User.find(current_user).name ? "Myself" : balance.user_name %></td>
    <td><%= balance.investments %></td>
    <td><%= balance.expenditures %></td>
    
    <td>
      <% if balance.investments.to_f - balance.expenditures.to_f < 0 %>
      Pay <%= balance.user_name %> Rs. <%= balance.expenditures.to_f - balance.investments.to_f %>
      <% elsif balance.investments.to_f - balance.expenditures.to_f > 0  %>
      Request <%= balance.user_name %> Rs. <%= balance.investments.to_f - balance.expenditures.to_f %>
      <% end -%>
    </td>
    </tr>
    <% end end %>
   </tbody>
</table>
<% end %>
<% end end -%>
<% end end -%>


